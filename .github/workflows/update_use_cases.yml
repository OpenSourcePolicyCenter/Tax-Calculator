name: Update Tax-Calculator Use Cases
on:
  schedule:
    - cron: '1 0 * * *'


jobs:
  fetch_use_cases:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Setup Miniconda
        uses: conda-incubator/setup-miniconda@v2.0.0
        with:
          activate-environment: taxcalc-dev
          environment-file: environment.yml
          python-version: 3.7
          auto-activate-base: false
          auto-update-conda: true

      - name: Build use cases file
        working-directory: ./
        shell: bash -l {0}
        run: |
          cd docs
          rm use_cases.md
          cd ..
          
          curl -H 'Zotero-API-Version: 3' -H 'Zotero-API-Key: MiQBsz0ilWhpsmQJyqeO2TzU' 'https://api.zotero.org/groups/2524233/items?format=bibtex&order=date&sort=desc&limit=100' --output citations.bib
          pybtex-format citations.bib citations.txt
          python bib_format.py
          pandoc -s citations2.txt -f gfm -o use_cases.md
          rm citations.bib citations.txt citations2.txt

          echo >> use_cases.md
          echo >> use_cases.md
          TZ=US/Eastern echo "Updated on $(date +'%Y-%m-%d') at $(date +"%I:%M %p")" >> use_cases.md

          mv use_cases.md docs/use_cases.md

          git config user.name github-actions
          git config user.email github-actions@github.com

          git add -A
          git commit -m "Update use-cases.md"
          git push
          